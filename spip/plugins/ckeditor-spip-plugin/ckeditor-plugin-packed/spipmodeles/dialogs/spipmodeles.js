function paramTypeChange(a,h,d,b,g){var c=a.getValue();var i="";for(var e in g){if(h==g[e][0]){if(g[e][3][c]&&(g[e][3][c].length>1)){d.clear();for(var f in g[e][3][c]){d.add(g[e][3][c][f].replace(/^.*\|/,""),g[e][3][c][f].replace(/\|.*$/,""))}d.getElement().show();b.getElement().hide()}else{if(g[e][3][c]&&(g[e][3][c].length==1)){i=g[e][3][c][0].replace(/\|.*$/,"");b.getElement().hide();d.getElement().hide()}else{b.getElement().show();d.getElement().hide()}}}}return i}function count(a){var d=0;for(var b in a){d++}return d}CKEDITOR.dialog.add("spipmodelesDlg",function(o){var e,g,r,q,k,p,n,f,d,b,j,i,h,l,a,c;e=o.lang.spipmodeles;return{title:e.label,minWidth:400,minHeight:200,onLoad:function(){f=this.getContentElement("tab1","paramvalSelect");d=this.getContentElement("tab1","paramvalInput");b=this.getContentElement("tab1","paramType");j=this.getContentElement("tab1","paramLigne");n=this.getContentElement("tab1","docId");h=this.getContentElement("tab1","selectDocId");q=this.tags;f.getElement().getParent().setAttribute("style","padding:0;margin:0;width:auto;");d.getElement().getParent().setAttribute("style","padding:0;margin:0;width:auto;")},onShow:function(){p=r=this.tag_requested;for(var m in this.tags){if(p==this.tags[m][0]){if(this.tags[m][7]=="html"){l='"';a='"';c=" "}else{l="";a="";c="|"}this.getContentElement("tab1","docId").setLabel(e.promptId.replace(/%id%/,this.tags[m][1]?this.tags[m][1]:"<"+r+">"));k=this.tags[m][5];if(k=="num-aucun"){this.getContentElement("tab1","numPanel").getElement().hide()}else{this.getContentElement("tab1","numPanel").getElement().show()}b.clear();for(var v in this.tags[m][3]){b.add(v.replace(/\|.*$/,""),v)}if(count(this.tags[m][3])==0){this.getContentElement("tab1","paramSet").getElement().hide()}else{this.getContentElement("tab1","paramSet").getElement().show()}i=paramTypeChange(b,p,f,d,q);if(this.tags[m][4]=="thisobject"){h.getElement().hide();n.setValue(o.config.spip_contexte.id)}else{if(this.tags[m][4]){var s;try{var t=$.ajax({url:CKEDITOR.spipurl+"?doctype="+this.tags[m][4]+"&page=spiplistes-json",async:false,global:false,dataType:"json"}).responseText;s=$.parseJSON(t)}catch(u){alert(e.page_introuvable+CKEDITOR.spipurl+"?doctype="+this.tags[m][4]+"&page=spiplistes-json");s=[]}h=this.getContentElement("tab1","selectDocId");h.clear();for(var w in s){h.add(s[w],w)}h.getElement().show();n.setValue(h.getValue())}else{h.getElement().hide();n.setValue("")}}}}},onOk:function(){var m=this.getValueOf("tab1","docId");if((!m&&(!k||k.match(/^num-(facultatif|aucun)$/)))||m.match(/\d+/)){p=r+(m?m:"");insertTag(o,p,r,j.getValue(),this.tags);return true}else{alert(e.erreur_nombre_obligatoire);return false}},contents:[{id:"tab1",label:e.parametres_des_modeles,title:e.parametres_des_modeles,elements:[{id:"panel1",type:"vbox",children:[{type:"hbox",id:"numPanel",children:[{type:"text",label:"",width:"80px",id:"docId",labelLayout:"horizontal"},{type:"select",width:"80px",id:"selectDocId",items:[],onChange:function(){n.setValue(h.getValue())}}]},{type:"fieldset",id:"paramSet",label:e.parametres,children:[{type:"vbox",children:[{type:"hbox",children:[{type:"select",id:"paramType",label:e.parametre,items:[],onChange:function(){i=paramTypeChange(b,p,f,d,q)}},{type:"select",id:"paramvalSelect",label:e.valeur,items:[]},{type:"text",id:"paramvalInput",label:e.valeur}]},{type:"button",id:"addparam",label:e.ajoute_parametre,onClick:function(){var s=b.getValue();var m=(f.isVisible()?f.getValue():(d.isVisible()?d.getValue():i));if(s.match(/\|/)){s=s.replace(/^.*\|/,"")}else{s=""}var t=j.getValue();j.setValue((t?t+c:"")+s+(s&&m?"=":"")+l+m+a)}}]}]},{type:"text",id:"paramLigne",label:e.parametres}]}]}]}});